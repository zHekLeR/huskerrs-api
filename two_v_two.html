<!DOCTYPE html>
<html>
<body>

<h1>HusKerrs' 2v2 Counter</h1>
<p></p>
<button id="pause" onclick="pause()">Pause</button><br><button id="send" onclick="sendScore()">Send Scores</button>
<br><br>
<input type="text" readonly="true" value="HusKerrs" size="8" style="text-align:center;"> Kills: <button onclick="add('hKills')">+</button> <sub id="hKills" style="font-size:18px;">0</sub> <button onclick="sub('hKills')">-</button><div>
<input type="text" placeholder="Teammate" size="8" style="text-align:center;"></input> Kills: <button onclick="add('tKills')">+</button> <sub id="tKills" style="font-size:18px;">0</sub> <button onclick="sub('tKills')">-</button>
<br>
<br>
<input type="text" placeholder="Opponent 1" size="8" style="text-align:center;"></input> Kills: <button onclick="add('o1Kills')">+</button> <sub id="o1Kills" style="font-size:18px;">0</sub> <button onclick="sub('o1Kills')">-</button><div>
<input type="text" placeholder="Opponent 2" size="8" style="text-align:center;"></input> Kills: <button onclick="add('o2Kills')">+</button> <sub id="o2Kills" style="font-size:18px;">0</sub> <button onclick="sub('o2Kills')">-</button>
<br><br>
<button onclick="reset()">Reset All</button>

<script>
    (function first() {
        fetch(`/twovtwoscores`, {
            method: "GET"
        }).then(res => res.text())
        .then(body => {
            scores = body.split(' ');
            if (scores.length == 4) {
                document.getElementById('hKills').stepUp(parseInt(scores[0]));
                document.getElementById('tKills').stepUp(parseInt(scores[1]));
                document.getElementById('o1Kills').stepUp(parseInt(scores[2]));
                document.getElementById('o2Kills').stepUp(parseInt(scores[3]));
            }
            console.log('Success during first.');
        }).catch(err => {
            console.log(`Error during first: ${err}`);
        })
    })();

    let sInt;

    function update() {
        try {
            fetch(`/post/${document.getElementById('hKills').innerHTML}/${document.getElementById('tKills').innerHTML}/${document.getElementById('o1Kills').innerHTML}/${document.getElementById('o2Kills').innerHTML}`, {
                method: "GET"
            });
            console.log('2v2 update success.');
        } catch (err) {
            if (err.message.includes('not enabled') && sInt) {
                clearInterval(sInt);
            }
            console.log(`Error during update function: ${err}`);
        }
    }

    sInt = setInterval(update, 15000);

    function sendScore() {
        try {
            fetch(`/send/${document.getElementById('hKills').innerHTML}/${document.getElementById('tKills').innerHTML}/${document.getElementById('o1Kills').innerHTML}/${document.getElementById('o2Kills').innerHTML}`, {
                method: "GET"
            });
            console.log('2v2 send success.');
        } catch (err) {
            if (err.message.includes('not enabled') && sInt) {
                clearInterval(sInt);
            }
            console.log(`Error during send function: ${err}`);
        }
    }

    function add(id) {
        document.getElementById(id).innerHTML = parseInt(document.getElementById(id).innerHTML) + 1;
    }

    function sub(id) {
        let x = document.getElementById(id);
        x.innerHTML = parseInt(x.innerHTML)==0?0:parseInt(x.innerHTML) - 1;
    }

    function pause() {
        try {
            fetch(`/tvtpause`, {
                method: "GET"
            }).then(res => {
                let text = document.getElementById("pause");
                text.innerHTML = text.innerHTML==='Pause'?'Resume':'Pause';
            }).catch(err => {
                console.log(`2v2 pause failed.`);
            })
        } catch (err) {
            console.log(`Error during pause function: ${err}`);
        }
    }

    function reset() {
        try {
            fetch(`/post/reset`, {
                method: "GET"
            }).then(res => {
                console.log('2v2 reset success.');
                document.getElementById('hKills').innerHTML = 0;
                document.getElementById('tKills').innerHTML = 0;
                document.getElementById('o1Kills').innerHTML = 0;
                document.getElementById('o2Kills').innerHTML = 0;
            }).catch(err => {
                console.log('2v2 reset failed.');
            });
        } catch (err) {
            console.log(`Error during 2v2 reset: ${err}`);
        }
    }
</script>

</body>
</html>